#include <windows.h>
#include "sampapi/CChat.h"
#include "kthook/kthook.hpp"

using CHud__DrawRadar = void(__cdecl*)(); // ???????? CHud::DrawRadar

kthook::kthook_simple_t<CHud__DrawRadar> samp_init_hook{ reinterpret_cast<void*>(0x58A330) }; // ??? ?? CHud::DrawRadar

void HOOK_after_samp_init() {
    static bool inited = false; // ?????????? ?????????????
    namespace samp = sampapi::v037r3; // ???? ?????? ?????, ? ???? ??? 037r3
    if (!inited && samp::RefChat() != nullptr) { // ???? ??? ?? ??????????????????, ? ??? ????? ??? ?????????????????
        samp::RefChat()->AddMessage(0xFFFFFFFF, "???? ????? ??????? ????? ????????????? ?????"); // ??????? ?????????
        samp::RefChat()->m_debugColor = 0xFFFF0000; // ?????? ???? ????????? ????????? ????? ?? ???????
        inited = true; // ???????? ??? ?????????????????
    }
}

BOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved)
{
    switch (ul_reason_for_call)
    {
    case DLL_PROCESS_ATTACH:
        DisableThreadLibraryCalls(hModule);
        samp_init_hook.after.connect(HOOK_after_samp_init); // ?????????? ???? ???????-??????? ????? ?????? CHud::DrawRadar
        break;
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}